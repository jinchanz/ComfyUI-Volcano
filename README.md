# ComfyUI-Volcano 火山引擎文本到图像节点

这是一个 ComfyUI 自定义节点，集成了火山引擎的文本到图像生成 API。

## 功能特性

- **文本生图 (T2I)**: 支持火山引擎的 jimeng_t2i_v31 和 jimeng_t2i_v30 模型
- **图生图 (I2I)**: 支持 jimeng_i2i_v30 模型，可对输入图像进行风格转换
- **智能生成 (Smart)**: 自动选择 T2I 或 I2I 模式，支持图片URL输入
- 可自定义图像尺寸（512x512 到 2048x2048）
- 支持种子值设置和缩放参数
- **批量生成**: 支持一次生成 1-8 张图片，并行处理提高效率
- 灵活的 API 密钥配置
- 完整的错误处理和状态反馈

## 安装方法

1. 将此文件夹复制到 ComfyUI 的 `custom_nodes` 目录
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```
3. 重启 ComfyUI

## 使用方法

### 基本使用

#### 文本生图 (T2I)
1. 在 ComfyUI 中添加 "火山引擎 T2I API" 节点
2. 配置以下参数：
   - **prompt**: 文本描述（支持多行）
   - **width**: 图像宽度（512-2048，步长64）
   - **height**: 图像高度（512-2048，步长64）
   - **seed**: 随机种子（-1为随机）
   - **req_key**: 模型版本（jimeng_t2i_v31 或 jimeng_t2i_v30）
   - **num_images**: 生成图片数量（1-8，支持并行处理）

#### 图生图 (I2I)
1. 在 ComfyUI 中添加 "火山引擎 I2I API" 节点
2. 配置以下参数：
   - **image**: 输入图像（从其他节点连接）
   - **prompt**: 修改提示词（如"背景换成演唱会现场"）
   - **scale**: 缩放参数（0.1-1.0，控制修改强度）
   - **seed**: 随机种子（-1为随机）
   - **req_key**: 模型版本（jimeng_i2i_v30）
   - **num_images**: 生成图片数量（1-8，支持并行处理）

#### 智能生成 (Smart)
1. 在 ComfyUI 中添加 "火山引擎 智能生成 API" 节点
2. 配置以下参数：
   - **prompt**: 文本描述（支持多行）
   - **width**: 图像宽度（512-2048，步长64）
   - **height**: 图像高度（512-2048，步长64）
   - **seed**: 随机种子（-1为随机）
   - **num_images**: 生成图片数量（1-8，支持并行处理）
   - **image_url**: 图片URL（留空则使用T2I，有URL则使用I2I）
   - **scale**: 缩放参数（I2I模式使用，0.1-1.0）
   - **t2i_req_key**: T2I模型版本（jimeng_t2i_v31 或 jimeng_t2i_v30）
   - **i2i_req_key**: I2I模型版本（jimeng_i2i_v30）

### 智能生成功能

**火山引擎 智能生成 API** 节点是一个融合节点，能够根据输入自动选择最合适的生成方式：

- **自动模式选择**: 
  - 如果 `image_url` 为空 → 自动使用 T2I（文本生图）模式
  - 如果 `image_url` 有值 → 自动使用 I2I（图生图）模式
  
- **参数完整性**: 保持所有参数的一致性，包括宽高、数量、种子等
- **智能图片处理**: 自动下载URL图片，调整尺寸，转换为合适的格式
- **统一输出**: 无论使用哪种模式，输出格式都完全一致

### 批量生成功能

所有节点都支持批量生成多张图片：

- **num_images 参数**: 设置要生成的图片数量（1-8张）
- **并行处理**: 使用线程池并行发送多个 API 请求，提高效率
- **智能种子**: 如果种子设为 -1，每张图片会自动生成不同的种子
- **批次输出**: 所有图片会合并为一个批次，方便后续处理

### API 密钥配置

有三种方式配置 API 密钥：

1. **输入参数**：直接在节点的 api_key 和 secret_key 字段中输入
2. **环境变量**：设置 `VOLC_AK` 和 `VOLC_SK` 环境变量
3. **默认密钥**：使用代码中的默认密钥（仅用于测试）

### 输出

节点会输出：
- **image**: 生成的图像（ComfyUI 图像格式）
- **info**: 生成状态信息或错误消息

## 注意事项

- 确保网络连接正常，能够访问火山引擎 API
- 建议在生产环境中使用环境变量或输入参数来配置 API 密钥
- 图像生成可能需要一些时间，请耐心等待
- 如果遇到错误，检查 API 密钥是否正确，以及网络连接是否正常

## 故障排除

### 常见错误

1. **API 响应无效**: 检查网络连接和 API 密钥
2. **未找到图像数据**: API 返回格式可能发生变化
3. **导入错误**: 确保已安装所有依赖包

### 调试建议

- 查看 ComfyUI 控制台输出的错误信息
- 检查 API 密钥是否正确
- 确认火山引擎服务状态

## 许可证

请遵循火山引擎的服务条款和 ComfyUI 的许可证要求。 